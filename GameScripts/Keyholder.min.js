//# sourceMappingURL=Keyholder.min.js.map
let Keyholder={};Keyholder.Game=function(){let t,e,i,n,o,s,r,a,h,l=9,c=!1,d=16,u=24,f=1,g=2,m=5,v=5,y=[],p=!1,w=2,b=32,T=0,x=0,k=8,I=14,O=!1,M=[3,4,7,9,10,11],C=!1;function j(a){window.requestAnimationFrame(j),function(){if(!1===c)return;function a(t,i,o,s){let r=t*d,a=i*d,h=o*(d+f),l=s*(u+f);e.drawImage(n,h,l,d,u,r*g,a*g,d*g,u*g)}e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),function(){for(let t=0;t<o.height;t++){for(let e=0;e<o.width;e++){let i,n,s,r=o.getTileType(e,t),h=P[o.getTileColor(e,t)];r<7?a(e,t,r+7*h.x,2*h.y):a(e,t,r-7+7*h.x,1+2*h.y),void 0!==(i=o.getKey(e,t))?s=9:void 0!==(i=o.getGate(e,t))?s=7:void 0!==(i=o.getChest(e,t))&&(s=1),void 0!==i&&(n=P[i.colorID],s<7?a(e,t,s+7*n.x,2*n.y):a(e,t,s-7+7*n.x,1+2*n.y))}editorMode?t===o.startY&&e.drawImage(i,o.startX*d*g,(o.startY*d-5)*g,16*g,25*g):t===v&&e.drawImage(i,m*d*g,(v*d-5)*g,16*g,25*g)}}(),editorMode?function(){let t=P[x];if(void 0===t)return;r.clearRect(0,0,s.width,s.height);let e=7*(d+f),i=2*(u+f),o=t.x*e,a=t.y*i;r.drawImage(n,o,a,e,i,0,0,e*w,i*w)}():function(){let t=0;for(let i=0;i<y.length;i++){let o=y[i],s=P[o],r=(2+7*s.x)*(d+f),a=(1+2*s.y)*(u+f);e.drawImage(n,r,a,d,u,t*g,l*d*g,d*g,u*g),t+=16}}()}()}function E(){this.startX=0,this.startY=0,this.width=0,this.height=0,this.tiles=[],this.keys=[],this.chests=[],this.gates=[],this.loadDefaultValues=function(t,e){this.startX=8,this.startY=4,this.width=t,this.height=e,this.tiles=new Array(t*e);for(let t=0;t<this.tiles.length;t++)this.tiles[t]=[k,I]},this.saveToJson=function(){return JSON.stringify(this)},this.loadFromJson=function(t){this.startX=t.startX,this.startY=t.startY,this.width=t.width,this.height=t.height,this.tiles=t.tiles,this.keys=t.keys,this.chests=t.chests,this.gates=t.gates},this.setTile=function(t,e,i,n){if(this.checkBounds(t,e)){let o=this.getTileIndex(t,e);this.tiles[o][0]=i,this.tiles[o][1]=n}},this.getTileType=function(t,e){let i=this.getTileIndex(t,e);return this.tiles[i][0]},this.getTileColor=function(t,e){let i=this.getTileIndex(t,e);return this.tiles[i][1]},this.getTileIndex=function(t,e){return e*this.width+t},this.checkBounds=function(t,e){return!(t<0||t>this.width-1||e<0||e>this.height-1)},this.removeMapObject=function(t,e,i){let n=i.find(function(i){return i.x===t&&i.y===e});return void 0!==n&&(function(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}(i,n),!0)},this.removeObjectsFromTile=function(t,e){return this.removeMapObject(t,e,this.chests)||this.removeMapObject(t,e,this.keys)||this.removeMapObject(t,e,this.gates)},this.isTileBlocking=function(t,e){if(!1===this.checkBounds(t,e))return!0;return!(8===this.getTileType(t,e))},this.isExit=function(t,e,i){let n=this.getTileType(t,e);return!!B(n)&&("N"===i?10===n:"E"===i?4===n:"S"===i?11===n:"W"===i?3===n:void 0)},this.addGate=function(t,e,i){this.addMapObject(t,e,i,this.gates)},this.addKey=function(t,e,i){this.addMapObject(t,e,i,this.keys)},this.addChest=function(t,e,i){this.addMapObject(t,e,i,this.chests)},this.addMapObject=function(t,e,i,n){this.removeObjectsFromTile(t,e),n.push(new function(t,e,i){this.x=t,this.y=e,this.colorID=i}(t,e,i))},this.getMapObject=function(t,e,i){for(let n=0;n<i.length;n++){let o=i[n];if(o.x===t&&o.y===e)return o}},this.getGate=function(t,e){return this.getMapObject(t,e,this.gates)},this.getKey=function(t,e){return this.getMapObject(t,e,this.keys)},this.getChest=function(t,e){return this.getMapObject(t,e,this.chests)},this.isGateOfColor=function(t,e,i){for(let n=0;n<this.gates.length;n++){let o=this.gates[n];if(o.x===t&&o.y===e&&o.colorID===i)return!0}return!1},this.isGateWithMatchingKey=function(t,e){for(let i=0;i<y.length;i++){let n=y[i];if(this.isGateOfColor(t,e,n))return!0}return!1},this.setStartPosition=function(t,e){this.startX=t,this.startY=e},this.isTileStartingPoint=function(t,e){return t===this.startX&&e===this.startY}}function B(t){return 3===t||4===t||10===t||11===t}function S(t){return 7===t}function D(t){return 1===t}function G(t){return 9===t}function K(t){return 8===t}function Y(t,e,i){if(p)return!1;if(!1===o.checkBounds(t,e))return!1;if(o.isExit(t,e,i))return p=!0,$("#victoryModal").on("hide.bs.modal",function(t){document.getElementById("victoryButton").click()}),$("#victoryModal").modal(),!0;if(!1===o.isTileBlocking(t,e)){if(void 0!==o.getGate(t,e))return o.isGateWithMatchingKey(t,e)&&o.removeMapObject(t,e,o.gates),!1;let s=o.getChest(t,e);if(void 0!==s){if("N"===i){if(F(t,e-1))return o.removeMapObject(t,e,o.chests),o.addChest(t,e-1,s.colorID),!0}else if("E"===i){if(F(t-1,e))return o.removeMapObject(t,e,o.chests),o.addChest(t-1,e,s.colorID),!0}else if("S"===i){if(F(t,e+1))return o.removeMapObject(t,e,o.chests),o.addChest(t,e+1,s.colorID),!0}else if("W"===i&&F(t+1,e))return o.removeMapObject(t,e,o.chests),o.addChest(t+1,e,s.colorID),!0;return!1}let r=o.getKey(t,e);return void 0===r||(n=r.colorID,!1===z(y,n)&&y.push(n),o.removeMapObject(t,e,o.keys),!0)}return!1;var n}function F(t,e){return!1!==o.checkBounds(t,e)&&(!1===o.isTileBlocking(t,e)&&void 0===o.getChest(t,e)&&void 0===o.getGate(t,e)&&void 0===o.getKey(t,e))}function J(){function t(t){$("#saveMessage").html(t),$("#saveModal").modal()}let e=$.ajax({type:"POST",data:{mapString:o.saveToJson(),name:h.value,currentMapID:mapID},url:"Save",dataType:"json",async:!0});e.done(function(e,i,n){let o=parseInt(e.mapID);console.log(e.mapID),0!==o?(mapID=o,t("Zapisano zmiany.")):t("Błąd - niepoprawna mapa")}),e.fail(function(e,i,n){console.log(n),t("Błąd - nie udało się zapisać zmian!")})}function L(){if(void 0===a)return;let t=a.x,e=a.y;if(!1===o.checkBounds(t,e))return;let i=T,n=x;if(void 0!==i&&void 0!==n){if(C)return o.removeObjectsFromTile(t,e),!1===K(o.getTileType(t,e))&&o.setTile(t,e,k,I),o.setStartPosition(t,e),void(C=!1);if(o.isTileStartingPoint(t,e)){if(!K(i))return;o.setTile(t,e,i,n)}!1===K(o.getTileType(t,e))&&(G(i)||S(i)||D(i))||(G(i)?o.addKey(t,e,n):S(i)?o.addGate(t,e,n):D(i)?o.addChest(t,e,n):B(i)?(o.setTile(t,e,i,n),o.removeObjectsFromTile(t,e)):(o.setTile(t,e,i,n),!1===K(i)&&o.removeObjectsFromTile(t,e)))}}function N(t,e){t>2||t<0||e>8||e<0||(this.x=t,this.y=e)}window.onload=function(){let y=function(t,e){let i=0,n=t.length,o=[];for(let s=0;s<t.length;s++){let r=new Image;r.onload=function(){++i===n&&(c=!0)},r.onerror=function(){console.log("Nie udało się załadować obrazka: "+r.src)},r.src=e+t[s],o[s]=r}return o}(["player.png","tiles.png"],"../../Images/");i=y[0],n=y[1],(t=document.getElementById("gameCanvas")).getContext&&(t.width=16*g*d,t.height=(l+1)*g*d+6*g,e=t.getContext("2d"),W(t),editorMode?(!function(){let t=pickerCells=document.getElementsByClassName("colorPicker");for(let e=0;e<t.length;e++){let i=t[e];i.style.width=b+"px",i.style.height=b+"px"}}(),(s=document.getElementById("editorCanvas")).height=2*g*(u+f),s.width=7*g*(d+f),r=s.getContext("2d"),W(s),(h=document.getElementById("mapNameTextArea")).value=mapName,function(){document.getElementById("saveButton").addEventListener("click",J),document.getElementById("setStartPositionButton").addEventListener("click",function(){C=!0}),t.addEventListener("mousemove",function(e){let i=R(t,e);!function(t,e){let i=Math.floor(t/(d*g)),n=Math.floor(e/(d*g));a={x:i,y:n}}(i.x,i.y-6*g),O&&void 0!==a&&L()}),t.addEventListener("mousedown",function(){void 0!==a?(L(),!1===z(M,T)&&!1===C&&(O=!0)):O=!1}),t.addEventListener("mouseup",function(){O=!1}),t.addEventListener("mouseout",function(){O=!1}),s.addEventListener("click",function(t){let e=R(s,t),i=Math.floor(e.x/((d+f)*w)),n=Math.floor(e.y/((u+f)*w));i<0||i>6||n<0||n>2||(T=i+7*n)}),function(){let t=document.getElementsByClassName("colorPicker");for(let i=0;i<t.length;i++){let n=t[i].id;t[i].addEventListener("click",function(){e(n)})}function e(t){if(void 0!==X[t]){let e=X[t];e!==x&&(x=X[t])}}}()}(),o=new E,null!==mapJsonObject?o.loadFromJson(mapJsonObject):o.loadDefaultValues(16,9)):(window.addEventListener("keydown",function(t){let e=t.keyCode;switch(e){case 37:Y(m-1,v,"E")&&m--;break;case 38:Y(m,v-1,"N")&&v--;break;case 39:Y(m+1,v,"W")&&m++;break;case 40:Y(m,v+1,"S")&&v++}}),(o=new E).loadFromJson(mapJsonObject),m=o.startX,v=o.startY),j(0))};let X={blue:0,darkGreen:1,green:2,lightGreen:3,mudGreen:4,orange:5,darkOrange:6,rust:7,red:8,lightRed:9,pink:10,purple:11,darkBlue:12,sand:13,grey:14,darkGrey:15},P=[new N(0,0),new N(0,1),new N(0,2),new N(0,3),new N(0,4),new N(0,5),new N(0,6),new N(0,7),new N(1,0),new N(1,1),new N(1,2),new N(1,3),new N(1,4),new N(1,5),new N(1,6),new N(1,7)];function z(t,e){return-1!==t.indexOf(e)}function R(t,e){let i=t.getBoundingClientRect();return{x:(e.clientX-i.left)/(i.right-i.left)*t.width,y:(e.clientY-i.top)/(i.bottom-i.top)*t.height}}function W(t){canvasContext=t.getContext("2d"),canvasContext.mozImageSmoothingEnabled=!1,canvasContext.webkitImageSmoothingEnabled=!1,canvasContext.msImageSmoothingEnabled=!1,canvasContext.imageSmoothingEnabled=!1}}();